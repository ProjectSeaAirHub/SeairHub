<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>요청이력조회 - The 채움+</title>

    <link rel="stylesheet" th:href="@{/css/base.css}">
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/components.css}">
    <link rel="stylesheet" th:href="@{/css/pages/FWD_transaction_history.css}">
</head>

<body>
<div class="container">
    <div th:replace="~{fragments/CUS_sidebar :: cusSidebarFragment(activeMenu='cusHistory')}"></div>
    <main class="main-content">
        <div th:replace="~{fragments/header :: headerFragment}"></div>
        <section class="content">
            <h2 class="page-title">요청이력조회</h2>

			<div class="controls-bar">
			    <div class="control-group date-group">
			        <input type="date" id="start-date" class="form-input date-input" th:value="${startDate}">
			        <span>~</span>
			        <input type="date" id="end-date" class="form-input date-input" th:value="${endDate}">
			    </div>
			    <form class="search-group" id="search-form" th:action="@{/cus/cusHistory}" method="get">
			        <input type="hidden" name="startDate" th:value="${startDate}">
			        <input type="hidden" name="endDate" th:value="${endDate}">
			        <input type="text" id="keyword-input" name="keyword" class="form-input" placeholder="품명 또는 담당포워더 검색" th:value="${keyword}">
			        <button type="submit" class="btn btn-primary">조회</button>
			        <button type="button" id="btn-calculate-summary" class="btn btn-orange">매출계산</button>
			    </form>
			</div>

            <div class="table-container">
                <table class="data-table transaction-table">
                    <thead>
                        <tr>
                            <th>거래일</th>
                            <th>품명</th>
                            <th>담당 포워더</th>
                            <th>확정 운임</th>
                            <th>최종 상태</th>
                            <th>관리</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:if="${historyPage.empty}">
                            <td colspan="6" style="text-align: center;">거래 이력이 없습니다.</td>
                        </tr>
                        <tr th:each="tx : ${historyPage.content}">
                            <td th:text="${#temporals.format(tx.transactionDate, 'yyyy. M. d.')}"></td>
                            <td th:text="${tx.itemName}"></td>
                            <td th:text="${tx.partnerName}"></td>
                            <td th:text="${#numbers.formatDecimal(tx.price, 0, 'COMMA', 2, 'POINT')} + ' ' + ${tx.currency}"></td>
                            <td>
                                <span class="status-badge" 
                                      th:text="${tx.status}" 
                                      th:classappend="${tx.status.toLowerCase()}"></span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline btn-rate-forwarder"
                                        th:attr="data-forwarder-name=${tx.partnerName}, data-item-name=${tx.itemName}">
                                    평점 주기
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

			<div class="pagination-container" th:if="${!historyPage.empty}">
			    <nav th:with="page=${historyPage},
			                   startPage = ${(page.number/10) * 10},
			                   endPage = ${T(java.lang.Math).min(startPage + 9, page.totalPages - 1)}">
			        <ul class="pagination">
			            <li th:classappend="${page.first} ? 'disabled'"><a th:href="@{/cus/cusHistory(page=0, startDate=${startDate}, endDate=${endDate}, keyword=${keyword})}">«</a></li>
			            <li th:classappend="${startPage == 0} ? 'disabled'"><a th:href="@{/cus/cusHistory(page=${startPage - 1}, startDate=${startDate}, endDate=${endDate}, keyword=${keyword})}">‹</a></li>
			
			            <li th:each="i : ${#numbers.sequence(startPage, endPage)}"
			                th:classappend="${i == page.number} ? 'active'">
			                <a th:href="@{/cus/cusHistory(page=${i}, startDate=${startDate}, endDate=${endDate}, keyword=${keyword})}" th:text="${i + 1}"></a>
			            </li>
			
			            <li th:classappend="${endPage >= page.totalPages - 1} ? 'disabled'"><a th:href="@{/cus/cusHistory(page=${endPage + 1}, startDate=${startDate}, endDate=${endDate}, keyword=${keyword})}">›</a></li>
			            <li th:classappend="${page.last} ? 'disabled'"><a th:href="@{/cus/cusHistory(page=${page.totalPages - 1}, startDate=${startDate}, endDate=${endDate}, keyword=${keyword})}">»</a></li>
			        </ul>
			    </nav>
			</div>
        </section>
    </main>
</div>


<div class="modal-wrapper" id="summary-modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h3 id="summary-modal-title">거래 합계</h3>
            <button class="btn-close">×</button>
        </div>
        <div class="modal-body" id="summary-modal-body">
            </div>
        <div class="modal-footer">
            <button class="btn btn-secondary btn-cancel">닫기</button>
        </div>
    </div>
</div>

<div class="modal-wrapper" id="rating-modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h3 id="rating-modal-title">포워더 평가</h3>
            <button class="btn-close">×</button>
        </div>
        <div class="modal-body rating-modal-body">
            <p style="text-align: center; line-height: 1.5;">
                <strong id="rating-forwarder-name" style="color: var(--danger-color);"></strong>에 대한<br>
                <strong id="rating-item-name"></strong> 운송 경험은 어떠셨나요?
            </p>
            <div class="rating-group">
                <span class="label">종합 만족도</span>
                <div class="star-rating">
                    <input type="radio" id="overall-5-stars" name="overall_rating" value="5" /><label for="overall-5-stars">★</label>
                    <input type="radio" id="overall-4-stars" name="overall_rating" value="4" /><label for="overall-4-stars">★</label>
                    <input type="radio" id="overall-3-stars" name="overall_rating" value="3" /><label for="overall-3-stars">★</label>
                    <input type="radio" id="overall-2-stars" name="overall_rating" value="2" /><label for="overall-2-stars">★</label>
                    <input type="radio" id="overall-1-star"  name="overall_rating" value="1" /><label for="overall-1-star">★</label>
                </div>
            </div>
            <div class="rating-group">
                <span class="label">가격</span>
                <div class="star-rating">
                    <input type="radio" id="price-5-stars" name="price_rating" value="5" /><label for="price-5-stars">★</label>
                    <input type="radio" id="price-4-stars" name="price_rating" value="4" /><label for="price-4-stars">★</label>
                    <input type="radio" id="price-3-stars" name="price_rating" value="3" /><label for="price-3-stars">★</label>
                    <input type="radio" id="price-2-stars" name="price_rating" value="2" /><label for="price-2-stars">★</label>
                    <input type="radio" id="price-1-star"  name="price_rating" value="1" /><label for="price-1-star">★</label>
                </div>
            </div>
            <div class="rating-group">
                <span class="label">속도</span>
                <div class="star-rating">
                    <input type="radio" id="speed-5-stars" name="speed_rating" value="5" /><label for="speed-5-stars">★</label>
                    <input type="radio" id="speed-4-stars" name="speed_rating" value="4" /><label for="speed-4-stars">★</label>
                    <input type="radio" id="speed-3-stars" name="speed_rating" value="3" /><label for="speed-3-stars">★</label>
                    <input type="radio" id="speed-2-stars" name="speed_rating" value="2" /><label for="speed-2-stars">★</label>
                    <input type="radio" id="speed-1-star"  name="speed_rating" value="1" /><label for="speed-1-star">★</label>
                </div>
            </div>
            <div class="rating-group">
                <span class="label">안정성</span>
                <div class="star-rating">
                    <input type="radio" id="stability-5-stars" name="stability_rating" value="5" /><label for="stability-5-stars">★</label>
                    <input type="radio" id="stability-4-stars" name="stability_rating" value="4" /><label for="stability-4-stars">★</label>
                    <input type="radio" id="stability-3-stars" name="stability_rating" value="3" /><label for="stability-3-stars">★</label>
                    <input type="radio" id="stability-2-stars" name="stability_rating" value="2" /><label for="stability-2-stars">★</label>
                    <input type="radio" id="stability-1-star"  name="stability_rating" value="1" /><label for="stability-1-star">★</label>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary btn-cancel">취소</button>
            <button class="btn btn-primary" id="btn-submit-rating">제출</button>
        </div>
    </div>
</div>

<script th:src="@{/js/CUS_history.js}"></script>
</body>
</html>